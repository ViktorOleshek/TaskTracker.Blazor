@using Domain.DTOs.Users.ChangePassword
@using Services.ExternalApi

<MudDialog>
	<DialogContent>
		<MudText>Change Password</MudText>
		<MudTextField Label="Current Password" InputType="InputType.Password" @bind-Value="changePasswordModel.OldPassword" Required="true" />
		<MudTextField Label="New Password" InputType="InputType.Password" @bind-Value="changePasswordModel.NewPassword" Required="true" />
	</DialogContent>
	<DialogActions>
		<MudButton OnClick="Submit" Color="Color.Primary">Save</MudButton>
		<MudButton OnClick="Cancel" Color="Color.Secondary">Cancel</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[Inject]
	private IDialogService DialogService { get; set; }

	[CascadingParameter]
	private IMudDialogInstance MudDialog { get; set; }

	[Inject]
	private IApiFacade ApiFacade { get; set; } = default!;

	private ChangePasswordDTO changePasswordModel = new();

	private async Task Submit()
	{
		var response = await ApiFacade.User.ChangePasswordAsync(changePasswordModel);
		if (response.IsSuccessStatusCode)
		{
			MudDialog?.Close(DialogResult.Ok(true));
		}
		else
		{
			MudDialog?.Close(DialogResult.Cancel());
		}
	}

	private void Cancel() => MudDialog?.Cancel();
}